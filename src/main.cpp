/*-----------------------------------------------------------------------------------------------------------------------*/
/* --  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- */
/* Main.cpp																												 */
/* --  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- */
/*-----------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------*/
/* General																						   */
/*-------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/
/* Includes																	 */
/*---------------------------------------------------------------------------*/
#define GLFW_INCLUDE_VULKAN
#include <GLFW/glfw3.h>
#include "rendering/renderer.h"

/*---------------------------------------------------------------------------*/
/* Metadata																	 */
/*---------------------------------------------------------------------------*/
#define VERSION 0.01
#define SCREEN_WIDTH 1600
#define SCREEN_HEIGHT 800
#define ENABLE_VALIDATION_LAYERS 1

/*-------------------------------------------------------------------------------------------------*/
/* Main																							   */
/*-------------------------------------------------------------------------------------------------*/
void main()
{
	/*-----------------------------------------------------------------------*/
	/* Basic Setup					        								 */
	/*-----------------------------------------------------------------------*/
	std::ostringstream o;
	o << std::setprecision(2) << std::noshowpoint << VERSION;
	std::cout << "Running Untitled, version: " + o.str() + "." << std::endl;

	/*-----------------------------------------------------------------------*/
	/* Rendering Setup					        							 */
	/*-----------------------------------------------------------------------*/
	Untitled::Renderer* renderer = new Untitled::Renderer( { VK_DYNAMIC_STATE_VIEWPORT, VK_DYNAMIC_STATE_SCISSOR }, SCREEN_WIDTH, SCREEN_HEIGHT, "Untitled", ENABLE_VALIDATION_LAYERS);
	GLFWwindow* window = renderer->GetWindow();

	/*-----------------------------------------------------------------------*/
	/* Main Loop        													 */
	/*-----------------------------------------------------------------------*/
	/* Delta Time Setup -----------------------------------------------------*/
	double lastTime = glfwGetTime();
	double deltaTime = 0.0;
	double sumTime = 0.0;
	unsigned int frameRate = 0;

	while (!glfwWindowShouldClose(window))
	{
		/* Delta Time -------------------------------------------------------*/
		double nowTime = glfwGetTime();
		deltaTime = nowTime - lastTime;
		lastTime = nowTime;
		sumTime += deltaTime;
		frameRate++;

		if (sumTime > 1.0)
		{
			sumTime = 0.0;
			std::cout << "FPS: " << frameRate << std::endl;
			frameRate = 0;
		}
		/*-------------------------------------------------------------------*/

		/* Render -----------------------------------------------------------*/
		renderer->Render();
		/*-------------------------------------------------------------------*/

		/* GLFW -------------------------------------------------------------*/
		glfwPollEvents();
		glfwSwapBuffers(window);
		/*-------------------------------------------------------------------*/
	}

	/*-----------------------------------------------------------------------*/
	/* Shutdown         													 */
	/*-----------------------------------------------------------------------*/
	std::cout << "Shutting down Untitled. Have a wonderful day!" << std::endl;
	delete(renderer);
	return;
}