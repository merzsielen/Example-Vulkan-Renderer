/*-----------------------------------------------------------------------------------------------------------------------*/
/* --  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- */
/* Main.cpp																												 */
/* --  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- */
/*-----------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------*/
/* Includes																						   */
/*-------------------------------------------------------------------------------------------------*/
#include <iostream>

#include "rendering/renderer.h"

/*-------------------------------------------------------------------------------------------------*/
/* Parameters																					   */
/*-------------------------------------------------------------------------------------------------*/
#define VERSION 0.01
#define SCREEN_WIDTH 1600
#define SCREEN_HEIGHT 800

/*-------------------------------------------------------------------------------------------------*/
/* Main																							   */
/*-------------------------------------------------------------------------------------------------*/
void main()
{
	/*-----------------------------------------------------------------------*/
	/* Basic Setup					        								 */
	/*-----------------------------------------------------------------------*/
	std::ostringstream o;
	o << std::setprecision(2) << std::noshowpoint << VERSION;
	std::cout << "Running VkExample, version: " + o.str() + "." << std::endl;

	/*-----------------------------------------------------------------------*/
	/* World & Rendering Setup					        					 */
	/*-----------------------------------------------------------------------*/
	VkExample::Camera* camera = new VkExample::Camera({ 0.0f, 0.0f, 0.0f }, { 1.0f, 0.0f, 0.0f, 0.0f }, 1.0f, 0.001f, 1000.0f);
	VkExample::Renderer* renderer = new VkExample::Renderer({ VK_DYNAMIC_STATE_VIEWPORT, VK_DYNAMIC_STATE_SCISSOR },
												SCREEN_WIDTH, SCREEN_HEIGHT, "VkExample", camera);
	GLFWwindow* window = renderer->GetWindow();

	/*-----------------------------------------------------------------------*/
	/* Main Loop        													 */
	/*-----------------------------------------------------------------------*/
	/* Delta Time Setup -----------------------------------------------------*/
	double lastTime = glfwGetTime();
	double deltaTime = 0.0;
	double sumTime = 0.0;
	unsigned int frameRate = 0;

	while (!glfwWindowShouldClose(window))
	{
		/* Delta Time -------------------------------------------------------*/
		double nowTime = glfwGetTime();
		deltaTime = nowTime - lastTime;
		lastTime = nowTime;
		sumTime += deltaTime;
		frameRate++;

		if (sumTime > 1.0)
		{
			sumTime = 0.0;
			std::cout << "FPS: " << frameRate << std::endl;
			frameRate = 0;
		}
		/*-------------------------------------------------------------------*/

		/* Render -----------------------------------------------------------*/
		renderer->Render();
		/*-------------------------------------------------------------------*/

		/* GLFW -------------------------------------------------------------*/
		glfwPollEvents();
		glfwSwapBuffers(window);
		/*-------------------------------------------------------------------*/
	}

	/*-----------------------------------------------------------------------*/
	/* Shutdown         													 */
	/*-----------------------------------------------------------------------*/
	std::cout << "Shutting down VkExample. Have a wonderful day!" << std::endl;

	delete(renderer);
}